<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/xep/disco.md at 2023-01-08
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20230108" />
    <meta http-equiv="Content-Language" content="en" />
    <title>XMPP.rocks - Documentation &#x2013; XEP-0030: Service Discovery</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script type="text/javascript" src="../js/apache-maven-fluido-1.7.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>XMPP.rocks - Documentation</h2>
</div>
</div>
        <div class="pull-right"><div id="bannerRight"><img src="../xmpp.png"  alt="XMPP.rocks - Documentation"/></div>
</div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2023-01-08<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 0.9.1</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://bitbucket.org/sco0ter/babbler/downloads" class="externalLink" title="Binaries">Binaries</a></li>
      <li class="pull-right"><a href="https://bitbucket.org/sco0ter/babbler/src" class="externalLink" title="Source Code">Source Code</a></li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Project Information</li>
    <li><a href="../index.html" title="About"><span class="none"></span>About</a></li>
    <li><a href="../xeps.html" title="Supported Specifications"><span class="none"></span>Supported Specifications</a></li>
    <li><a href="../license.html" title="License"><span class="none"></span>License</a></li>
    <li><a href="../changelog.html" title="Changelog"><span class="none"></span>Changelog</a></li>
    <li><a href="../releasenotes.html" title="Release Notes"><span class="none"></span>Release Notes</a></li>
      <li class="nav-header">User Guide</li>
    <li><a href="../basics.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../basic-concepts.html" title="Basic Concepts"><span class="none"></span>Basic Concepts</a></li>
    <li><a href="../im.html" title="Contacts, Presence and Messaging"><span class="none"></span>Contacts, Presence and Messaging</a></li>
    <li><a href="../extensions.html" title="Using Extensions"><span class="none"></span>Using Extensions</a></li>
    <li><a href="../customextensions.html" title="Writing Custom Extensions"><span class="none"></span>Writing Custom Extensions</a></li>
    <li><a href="../customiq.html" title="Custom IQs"><span class="none"></span>Custom IQs</a></li>
    <li><a href="../customauthentication.html" title="Custom Authentication"><span class="none"></span>Custom Authentication</a></li>
    <li><a href="../errors.html" title="Exceptions and XMPP Errors"><span class="none"></span>Exceptions and XMPP Errors</a></li>
    <li><a href="../reconnection.html" title="Dis- and Reconnection"><span class="none"></span>Dis- and Reconnection</a></li>
    <li><a href="../debugging.html" title="Debugging XMPP Traffic"><span class="none"></span>Debugging XMPP Traffic</a></li>
    <li><a href="../buildinstructions.html" title="Build Instructions"><span class="none"></span>Build Instructions</a></li>
      <li class="nav-header">Extension Guide</li>
    <li><a href="../xep/filetransfer.html" title="File Transfer"><span class="none"></span>File Transfer</a></li>
    <li><a href="../xep/avatar.html" title="Avatars"><span class="none"></span>Avatars</a></li>
    <li><a href="../xep/httpbind.html" title="HTTP Binding / BOSH"><span class="none"></span>HTTP Binding / BOSH</a></li>
    <li><a href="../xep/externalcomponents.html" title="External Components"><span class="none"></span>External Components</a></li>
    <li><a href="../xep/rpc.html" title="XEP-0009: Jabber-RPC"><span class="none"></span>XEP-0009: Jabber-RPC</a></li>
    <li><a href="../xep/last.html" title="Last Activity and Idle Time"><span class="none"></span>Last Activity and Idle Time</a></li>
    <li><a href="../xep/privacy.html" title="XEP-0016: Privacy Lists"><span class="none"></span>XEP-0016: Privacy Lists</a></li>
    <li class="active"><a href="#"><span class="none"></span>XEP-0030: Service Discovery</a></li>
    <li><a href="../xep/muc.html" title="XEP-0045: Multi-User Chat"><span class="none"></span>XEP-0045: Multi-User Chat</a></li>
    <li><a href="../xep/bookmarks.html" title="XEP-0048: Bookmarks"><span class="none"></span>XEP-0048: Bookmarks</a></li>
    <li><a href="../xep/vcard.html" title="XEP-0054: vcard-temp"><span class="none"></span>XEP-0054: vcard-temp</a></li>
    <li><a href="../xep/pubsub.html" title="XEP-0060: Publish-Subscribe"><span class="none"></span>XEP-0060: Publish-Subscribe</a></li>
    <li><a href="../xep/xhtmlim.html" title="XEP-0071: XHTML-IM"><span class="none"></span>XEP-0071: XHTML-IM</a></li>
    <li><a href="../xep/soap.html" title="XEP-0072: SOAP Over XMPP"><span class="none"></span>XEP-0072: SOAP Over XMPP</a></li>
    <li><a href="../xep/amp.html" title="XEP-0079: Advanced Message Processing"><span class="none"></span>XEP-0079: Advanced Message Processing</a></li>
    <li><a href="../xep/geoloc.html" title="XEP-0080: User Location"><span class="none"></span>XEP-0080: User Location</a></li>
    <li><a href="../xep/version.html" title="XEP-0092: Software Version"><span class="none"></span>XEP-0092: Software Version</a></li>
    <li><a href="../xep/rosterx.html" title="XEP-0144: Roster Item Exchange"><span class="none"></span>XEP-0144: Roster Item Exchange</a></li>
    <li><a href="../xep/pep.html" title="XEP-0163: Personal Eventing Protocol"><span class="none"></span>XEP-0163: Personal Eventing Protocol</a></li>
    <li><a href="../xep/receipts.html" title="XEP-0184: Message Delivery Receipts"><span class="none"></span>XEP-0184: Message Delivery Receipts</a></li>
    <li><a href="../xep/time.html" title="XEP-0202: Entity Time"><span class="none"></span>XEP-0202: Entity Time</a></li>
    <li><a href="../xep/delay.html" title="XEP-0203: Delayed Delivery"><span class="none"></span>XEP-0203: Delayed Delivery</a></li>
    <li><a href="../xep/carbons.html" title="XEP-0280: Message Carbons"><span class="none"></span>XEP-0280: Message Carbons</a></li>
    <li><a href="../xep/rtt.html" title="XEP-0301: In-Band Real Time Text"><span class="none"></span>XEP-0301: In-Band Real Time Text</a></li>
    <li><a href="../xep/message-correct.html" title="XEP-0308: Last Message Correction"><span class="none"></span>XEP-0308: Last Message Correction</a></li>
      <li class="nav-header">API Documentation</li>
    <li><a href="../apidocs/index.html" title="JavaDoc"><span class="none"></span>JavaDoc</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="../" title="" class="builtBy"><img class="builtBy"  alt="" src="../"    /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span9" >
<h1>XEP-0030: Service Discovery</h1><hr />
<p><a class="externalLink" href="https://xmpp.org/extensions/xep-0030.html" title="XEP-0030: Service Discovery">XEP-0030: Service Discovery</a> allows you to discover features and items of another XMPP entity.</p>
<p>By enabling an extension (XEP), you automatically support it and it will be listed in the feature list of your service
discovery response.</p>
<p>E.g., if you have enabled support for <a class="externalLink" href="https://xmpp.org/extensions/xep-0092.html" title="XEP-0092: Software Version">XEP-0092: Software Version</a> your client automatically includes
this XEP in its feature list, when it responds to a query.</p>
<p>Generally speaking all enabled extensions will be added to the feature list of service discovery. If you disable a
certain extension, it will be removed.</p><section>
<h2><a name="Discovering_Information"></a>Discovering Information</h2>
<p>You discover information about another XMPP entity by sending a request to it:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">ServiceDiscoveryManager serviceDiscoveryManager = xmppClient.getManager(ServiceDiscoveryManager.class);
DiscoverableInfo discoverableInfo = serviceDiscoveryManager.discoverInformation(Jid.of(&quot;example.net&quot;)).getResult();
</code></pre></div>
<p><code>discoverableInfo</code> will contain information about the entity, i.e. its identity and features it supports.</p><section>
<h3><a name="Determining_Feature_Support"></a>Determining Feature Support</h3>
<p>For most use cases you are probably only interested if another entity supports a specific feature.</p>
<p>Because that use case is specified by nearly every XEP (&#x201c;determining support&#x201d;), there's a convenience method for it
directly on <code>XmppClient</code>, which internally also uses <a class="externalLink" href="https://xmpp.org/extensions/xep-0115.html" title="XEP-0115: Entity Capabilities">XEP-0115: Entity Capabilities</a> (for
optimization and caching):</p>

<div class="source"><pre class="prettyprint"><code>boolean supportsChatStates = xmppClient.isSupported(ChatState.NAMESPACE, Jid.of(&quot;romeo@example.net/park&quot;)).getResult();
</code></pre></div>
<p>Note that the passed JID should be a full JID in most cases (if you want to check client capabilities).</p>
<p>This method will first check the cache for entity capabilities. Only if no cache entry is found it will ask the entity
via Service Discovery.</p></section></section><section>
<h2><a name="Discovering_Items"></a>Discovering Items</h2>
<p>You can also discover items associated with an XMPP entity.</p>

<div class="source"><pre class="prettyprint"><code>ItemNode node = serviceDiscoveryManager.discoverItems(Jid.of(&quot;example.net&quot;)).getResult();
List&lt;Item&gt; items = node.getItems();
</code></pre></div>
<p>This will discover items at the &#x201c;root&#x201d; node, but you can also discover items at another node:</p>

<div class="source"><pre class="prettyprint"><code>ItemNode node = serviceDiscoveryManager.discoverItems(Jid.of(&quot;example.net&quot;), &quot;music&quot;).getResult();
List&lt;Item&gt; items = node.getItems();
</code></pre></div><section>
<h3><a name="Limited_Result_Sets"></a>Limited Result Sets</h3>
<p>You can request a limited result set like this, which will request the first 20 items:</p>

<div class="source"><pre class="prettyprint"><code>ItemNode itemNode = serviceDiscoveryManager.discoverItems(Jid.of(&quot;example.net&quot;), ResultSetManagement.forLimit(20)).getResult();
List&lt;Item&gt; items = itemNode.getItems();
</code></pre></div>
<p>For more limited result set options refer to <code>ResultSetManagement</code>.</p></section></section><section>
<h2><a name="Discovering_Services"></a>Discovering Services</h2>
<p>The following would discover Multi-User Chat services at your server:</p>

<div class="source"><pre class="prettyprint"><code>serviceDiscoveryManager.discoverServices(Muc.NAMESPACE).getResult();
</code></pre></div></section><section>
<h2><a name="Providing_Items"></a>Providing Items</h2>
<p>If you want to publish items yourself (which then can be discovered by other entities), you should set an item provider
like this:</p>

<div class="source"><pre class="prettyprint"><code>Collection&lt;Item&gt; myItems = ...;
serviceDiscoveryManager.setItemProvider(new DefaultItemProvider(myItems));
</code></pre></div>
<p>The <code>DefaultItemProvider</code> keeps the items in memory. If you want to set another source as items (e.g. from a database),
create your own implementation of
<code>ResultSetProvider&lt;Item&gt;</code> instead.</p><section>
<h3><a name="Result_Set_Management"></a>Result Set Management</h3>
<p><code>ResultSetProvider&lt;T&gt;</code> provides methods which are necessary for enabling support
for <a class="externalLink" href="https://xmpp.org/extensions/xep-0059.html" title="XEP-0059: Result Set Management">XEP-0059: Result Set Management</a>:</p>

<div class="source"><pre class="prettyprint"><code>public interface ResultSetProvider&lt;T extends ResultSetItem&gt; {
    List&lt;T&gt; getItems();
    int getItemCount();
    List&lt;T&gt; getItems(int index, int maxSize);
    List&lt;T&gt; getItemsAfter(String itemId, int maxSize);
    List&lt;T&gt; getItemsBefore(String itemId, int maxSize);
    int indexOf(String itemId);
}
</code></pre></div>
<p>E.g., speaking in XMPP terms, when your client receives a <code>disco#items</code> request with a RSM
extension <code>&lt;set xmlns='http://jabber.org/protocol/rsm'&gt;&lt;max&gt;20&lt;/max&gt;&lt;/set&gt;</code>, the <code>getItems(0, 20)</code> will be called, which
should return the first 20 items.</p></section></section><section>
<h2><a name="Identities"></a>Identities</h2>
<p>An entity in XMPP can have one or more identities, which consists of a category (server, client, gateway, directory,
etc.) and a type within that category (IM server, phone vs. handheld client, MSN gateway vs. AIM gateway, user directory
vs. chatroom directory, etc.).</p>
<p>This information helps requesting entities to determine the group or &#x201c;bucket&#x201d; of services into which the entity is most
appropriately placed (e.g., perhaps the entity is shown in a GUI with an appropriate icon).</p>
<p>You can add such identities with:</p>

<div class="source"><pre class="prettyprint"><code>// Adds an identity of category &quot;client&quot; and type &quot;pc&quot;:
serviceDiscoveryManager.addIdentity(Identity.clientPc());
</code></pre></div>
<p><i>client/pc</i> is also the default identity, if none was added (every entity requires at least one identity), so in most
cases you don't need to add one.</p></section>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2014&#x2013;2023
<a href="http://xmpp.rocks">XMPP.rocks</a>.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
