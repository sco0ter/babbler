<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src\site\markdown/xep\last.md at 2022-09-26
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20220926" />
    <meta http-equiv="Content-Language" content="en" />
    <title>XMPP.rocks - Documentation &#x2013; Last Activity and Idle Time</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script type="text/javascript" src="../js/apache-maven-fluido-1.7.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>XMPP.rocks - Documentation</h2>
</div>
</div>
        <div class="pull-right"><div id="bannerRight"><img src="../xmpp.png"  alt="XMPP.rocks - Documentation"/></div>
</div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2022-09-26<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 0.9.0</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://bitbucket.org/sco0ter/babbler/downloads" class="externalLink" title="Binaries">Binaries</a></li>
      <li class="pull-right"><a href="https://bitbucket.org/sco0ter/babbler/src" class="externalLink" title="Source Code">Source Code</a></li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Project Information</li>
    <li><a href="../index.html" title="About"><span class="none"></span>About</a></li>
    <li><a href="../xeps.html" title="Supported Specifications"><span class="none"></span>Supported Specifications</a></li>
    <li><a href="../license.html" title="License"><span class="none"></span>License</a></li>
    <li><a href="../changelog.html" title="Changelog"><span class="none"></span>Changelog</a></li>
    <li><a href="../releasenotes.html" title="Release Notes"><span class="none"></span>Release Notes</a></li>
      <li class="nav-header">User Guide</li>
    <li><a href="../basics.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../basic-concepts.html" title="Basic Concepts"><span class="none"></span>Basic Concepts</a></li>
    <li><a href="../im.html" title="Contacts, Presence and Messaging"><span class="none"></span>Contacts, Presence and Messaging</a></li>
    <li><a href="../extensions.html" title="Using Extensions"><span class="none"></span>Using Extensions</a></li>
    <li><a href="../customextensions.html" title="Writing Custom Extensions"><span class="none"></span>Writing Custom Extensions</a></li>
    <li><a href="../customiq.html" title="Custom IQs"><span class="none"></span>Custom IQs</a></li>
    <li><a href="../customauthentication.html" title="Custom Authentication"><span class="none"></span>Custom Authentication</a></li>
    <li><a href="../errors.html" title="Exceptions and XMPP Errors"><span class="none"></span>Exceptions and XMPP Errors</a></li>
    <li><a href="../reconnection.html" title="Dis- and Reconnection"><span class="none"></span>Dis- and Reconnection</a></li>
    <li><a href="../debugging.html" title="Debugging XMPP Traffic"><span class="none"></span>Debugging XMPP Traffic</a></li>
    <li><a href="../buildinstructions.html" title="Build Instructions"><span class="none"></span>Build Instructions</a></li>
      <li class="nav-header">Extension Guide</li>
    <li><a href="../xep/filetransfer.html" title="File Transfer"><span class="none"></span>File Transfer</a></li>
    <li><a href="../xep/avatar.html" title="Avatars"><span class="none"></span>Avatars</a></li>
    <li><a href="../xep/httpbind.html" title="HTTP Binding / BOSH"><span class="none"></span>HTTP Binding / BOSH</a></li>
    <li><a href="../xep/externalcomponents.html" title="External Components"><span class="none"></span>External Components</a></li>
    <li><a href="../xep/rpc.html" title="XEP-0009: Jabber-RPC"><span class="none"></span>XEP-0009: Jabber-RPC</a></li>
    <li class="active"><a href="#"><span class="none"></span>Last Activity and Idle Time</a></li>
    <li><a href="../xep/privacy.html" title="XEP-0016: Privacy Lists"><span class="none"></span>XEP-0016: Privacy Lists</a></li>
    <li><a href="../xep/disco.html" title="XEP-0030: Service Discovery"><span class="none"></span>XEP-0030: Service Discovery</a></li>
    <li><a href="../xep/muc.html" title="XEP-0045: Multi-User Chat"><span class="none"></span>XEP-0045: Multi-User Chat</a></li>
    <li><a href="../xep/bookmarks.html" title="XEP-0048: Bookmarks"><span class="none"></span>XEP-0048: Bookmarks</a></li>
    <li><a href="../xep/vcard.html" title="XEP-0054: vcard-temp"><span class="none"></span>XEP-0054: vcard-temp</a></li>
    <li><a href="../xep/pubsub.html" title="XEP-0060: Publish-Subscribe"><span class="none"></span>XEP-0060: Publish-Subscribe</a></li>
    <li><a href="../xep/xhtmlim.html" title="XEP-0071: XHTML-IM"><span class="none"></span>XEP-0071: XHTML-IM</a></li>
    <li><a href="../xep/soap.html" title="XEP-0072: SOAP Over XMPP"><span class="none"></span>XEP-0072: SOAP Over XMPP</a></li>
    <li><a href="../xep/amp.html" title="XEP-0079: Advanced Message Processing"><span class="none"></span>XEP-0079: Advanced Message Processing</a></li>
    <li><a href="../xep/geoloc.html" title="XEP-0080: User Location"><span class="none"></span>XEP-0080: User Location</a></li>
    <li><a href="../xep/version.html" title="XEP-0092: Software Version"><span class="none"></span>XEP-0092: Software Version</a></li>
    <li><a href="../xep/rosterx.html" title="XEP-0144: Roster Item Exchange"><span class="none"></span>XEP-0144: Roster Item Exchange</a></li>
    <li><a href="../xep/pep.html" title="XEP-0163: Personal Eventing Protocol"><span class="none"></span>XEP-0163: Personal Eventing Protocol</a></li>
    <li><a href="../xep/receipts.html" title="XEP-0184: Message Delivery Receipts"><span class="none"></span>XEP-0184: Message Delivery Receipts</a></li>
    <li><a href="../xep/time.html" title="XEP-0202: Entity Time"><span class="none"></span>XEP-0202: Entity Time</a></li>
    <li><a href="../xep/delay.html" title="XEP-0203: Delayed Delivery"><span class="none"></span>XEP-0203: Delayed Delivery</a></li>
    <li><a href="../xep/carbons.html" title="XEP-0280: Message Carbons"><span class="none"></span>XEP-0280: Message Carbons</a></li>
    <li><a href="../xep/rtt.html" title="XEP-0301: In-Band Real Time Text"><span class="none"></span>XEP-0301: In-Band Real Time Text</a></li>
    <li><a href="../xep/message-correct.html" title="XEP-0308: Last Message Correction"><span class="none"></span>XEP-0308: Last Message Correction</a></li>
      <li class="nav-header">API Documentation</li>
    <li><a href="../apidocs/index.html" title="JavaDoc"><span class="none"></span>JavaDoc</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="../" title="" class="builtBy"><img class="builtBy"  alt="" src="../"    /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span9" >
<h1>Last Activity and Idle Time</h1><hr />
<p><a class="externalLink" href="https://xmpp.org/extensions/xep-0012.html" title="XEP-0012: Last Activity">XEP-0012: Last Activity</a> allows you to determine the last activity of an XMPP entity.</p>
<p>It's also tightly coupled with <a class="externalLink" href="https://xmpp.org/extensions/xep-0256.html" title="XEP-0256: Last Activity in Presence">XEP-0256: Last Activity in Presence</a>
and <a class="externalLink" href="https://xmpp.org/extensions/xep-0319.html" title="XEP-0319: Last User Interaction in Presence">XEP-0319: Last User Interaction in Presence</a>.</p><section>
<h2><a name="Getting_the_Last_Logout_Date"></a>Getting the Last Logout Date</h2>
<p>If you want to find out how long ago a user logged out, you query for the user's bare JID. The server should then answer
on behalf of the user with the last logout date.</p>

<div class="source"><pre class="prettyprint"><code class="language-java">LastActivityManager lastActivityManager = xmppClient.getManager(LastActivityManager.class);
LastActivity lastActivity = lastActivityManager.getLastActivity(Jid.of(&quot;juliet@im.example.com&quot;)).getResult();
// user logged out lastActivity.getSeconds() ago
</code></pre></div></section><section>
<h2><a name="Getting_the_Idle_Time_of_Available_Entities"></a>Getting the Idle Time of Available Entities</h2>
<p>In order to query a connected user for its idle time you must query for its full JID, so that the XMPP server routes the
query directly to the resource.</p>

<div class="source"><pre class="prettyprint"><code class="language-java">LastActivityManager lastActivityManager = xmppClient.getManager(LastActivityManager.class);
LastActivity lastActivity = lastActivityManager.getLastActivity(Jid.of(&quot;juliet@im.example.com/resource&quot;));
Instant idleTime = Instant.now().minusSeconds(lastActivity.getSeconds());
</code></pre></div>
<p>If supported by the client, it will respond with its idle time.</p>
<p>Alternatively, if a contact/client supports <a class="externalLink" href="https://xmpp.org/extensions/xep-0256.html" title="XEP-0256: Last Activity in Presence">XEP-0256: Last Activity in Presence</a>
or <a class="externalLink" href="https://xmpp.org/extensions/xep-0319.html" title="XEP-0319: Last User Interaction in Presence">XEP-0319: Last User Interaction in Presence</a>, it will include idle time in its
presence.</p>
<p>Just listen for presence and extract the idle time like shown below, which will try to get the idle time by first trying
XEP-0319, and then XEP-0256 (also respecting delayed delivery).</p>

<div class="source"><pre class="prettyprint"><code class="language-java">xmppClient.addInboundPresenceListener(e -&gt; {
    Instant idleSince = Idle.timeFromPresence(e.getPresence());
});
</code></pre></div></section><section>
<h2><a name="Setting_the_Idle_Time_of_Your_Client"></a>Setting the Idle Time of Your Client</h2>
<p>The idle time can be set via a strategy pattern, which let's you define different strategies for determining idle time.
E.g. you could track the last mouse movement or keyboard input. By default, the last sent message is used to determine
your idle time.</p>

<div class="source"><pre class="prettyprint"><code class="language-java">lastActivityManager.setIdleStrategy(() -&gt; {
    // Return whatever your idle time is.
    return Instant.now();
});
</code></pre></div>
<p>This time will be returned if another entity asks you for your idle time and will also be included in outbound &#x2018;away&#x2019;
and &#x2018;extended away&#x2019; presences, in order to inform your contacts automatically, so that they don't need to ask you.</p>
<p>If you don't want to reveal your idle time, you have to disable the manager, otherwise keep it enabled.</p>

<div class="source"><pre class="prettyprint"><code class="language-java">lastActivityManager.setEnabled(false);
</code></pre></div></section><section>
<h2><a name="Getting_the_Server_Uptime"></a>Getting the Server Uptime</h2>
<p>When querying a server or component the result is the uptime of it.</p>

<div class="source"><pre class="prettyprint"><code class="language-java">LastActivityManager lastActivityManager = xmppClient.getManager(LastActivityManager.class);
LastActivity lastActivity = lastActivityManager.getLastActivity(Jid.of(&quot;im.example.com&quot;)).getResult();
Instant uptime = Instant.now().minusSeconds(lastActivity.getSeconds());
</code></pre></div></section>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2014&#x2013;2022
<a href="http://xmpp.rocks">XMPP.rocks</a>.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
