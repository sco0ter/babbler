<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src\site\markdown/xep\muc.md at 2022-09-26
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20220926" />
    <meta http-equiv="Content-Language" content="en" />
    <title>XMPP.rocks - Documentation &#x2013; XEP-0045: Multi-User Chat</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script type="text/javascript" src="../js/apache-maven-fluido-1.7.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>XMPP.rocks - Documentation</h2>
</div>
</div>
        <div class="pull-right"><div id="bannerRight"><img src="../xmpp.png"  alt="XMPP.rocks - Documentation"/></div>
</div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2022-09-26<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 0.9.0</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://bitbucket.org/sco0ter/babbler/downloads" class="externalLink" title="Binaries">Binaries</a></li>
      <li class="pull-right"><a href="https://bitbucket.org/sco0ter/babbler/src" class="externalLink" title="Source Code">Source Code</a></li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Project Information</li>
    <li><a href="../index.html" title="About"><span class="none"></span>About</a></li>
    <li><a href="../xeps.html" title="Supported Specifications"><span class="none"></span>Supported Specifications</a></li>
    <li><a href="../license.html" title="License"><span class="none"></span>License</a></li>
    <li><a href="../changelog.html" title="Changelog"><span class="none"></span>Changelog</a></li>
    <li><a href="../releasenotes.html" title="Release Notes"><span class="none"></span>Release Notes</a></li>
      <li class="nav-header">User Guide</li>
    <li><a href="../basics.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../basic-concepts.html" title="Basic Concepts"><span class="none"></span>Basic Concepts</a></li>
    <li><a href="../im.html" title="Contacts, Presence and Messaging"><span class="none"></span>Contacts, Presence and Messaging</a></li>
    <li><a href="../extensions.html" title="Using Extensions"><span class="none"></span>Using Extensions</a></li>
    <li><a href="../customextensions.html" title="Writing Custom Extensions"><span class="none"></span>Writing Custom Extensions</a></li>
    <li><a href="../customiq.html" title="Custom IQs"><span class="none"></span>Custom IQs</a></li>
    <li><a href="../customauthentication.html" title="Custom Authentication"><span class="none"></span>Custom Authentication</a></li>
    <li><a href="../errors.html" title="Exceptions and XMPP Errors"><span class="none"></span>Exceptions and XMPP Errors</a></li>
    <li><a href="../reconnection.html" title="Dis- and Reconnection"><span class="none"></span>Dis- and Reconnection</a></li>
    <li><a href="../debugging.html" title="Debugging XMPP Traffic"><span class="none"></span>Debugging XMPP Traffic</a></li>
    <li><a href="../buildinstructions.html" title="Build Instructions"><span class="none"></span>Build Instructions</a></li>
      <li class="nav-header">Extension Guide</li>
    <li><a href="../xep/filetransfer.html" title="File Transfer"><span class="none"></span>File Transfer</a></li>
    <li><a href="../xep/avatar.html" title="Avatars"><span class="none"></span>Avatars</a></li>
    <li><a href="../xep/httpbind.html" title="HTTP Binding / BOSH"><span class="none"></span>HTTP Binding / BOSH</a></li>
    <li><a href="../xep/externalcomponents.html" title="External Components"><span class="none"></span>External Components</a></li>
    <li><a href="../xep/rpc.html" title="XEP-0009: Jabber-RPC"><span class="none"></span>XEP-0009: Jabber-RPC</a></li>
    <li><a href="../xep/last.html" title="Last Activity and Idle Time"><span class="none"></span>Last Activity and Idle Time</a></li>
    <li><a href="../xep/privacy.html" title="XEP-0016: Privacy Lists"><span class="none"></span>XEP-0016: Privacy Lists</a></li>
    <li><a href="../xep/disco.html" title="XEP-0030: Service Discovery"><span class="none"></span>XEP-0030: Service Discovery</a></li>
    <li class="active"><a href="#"><span class="none"></span>XEP-0045: Multi-User Chat</a></li>
    <li><a href="../xep/bookmarks.html" title="XEP-0048: Bookmarks"><span class="none"></span>XEP-0048: Bookmarks</a></li>
    <li><a href="../xep/vcard.html" title="XEP-0054: vcard-temp"><span class="none"></span>XEP-0054: vcard-temp</a></li>
    <li><a href="../xep/pubsub.html" title="XEP-0060: Publish-Subscribe"><span class="none"></span>XEP-0060: Publish-Subscribe</a></li>
    <li><a href="../xep/xhtmlim.html" title="XEP-0071: XHTML-IM"><span class="none"></span>XEP-0071: XHTML-IM</a></li>
    <li><a href="../xep/soap.html" title="XEP-0072: SOAP Over XMPP"><span class="none"></span>XEP-0072: SOAP Over XMPP</a></li>
    <li><a href="../xep/amp.html" title="XEP-0079: Advanced Message Processing"><span class="none"></span>XEP-0079: Advanced Message Processing</a></li>
    <li><a href="../xep/geoloc.html" title="XEP-0080: User Location"><span class="none"></span>XEP-0080: User Location</a></li>
    <li><a href="../xep/version.html" title="XEP-0092: Software Version"><span class="none"></span>XEP-0092: Software Version</a></li>
    <li><a href="../xep/rosterx.html" title="XEP-0144: Roster Item Exchange"><span class="none"></span>XEP-0144: Roster Item Exchange</a></li>
    <li><a href="../xep/pep.html" title="XEP-0163: Personal Eventing Protocol"><span class="none"></span>XEP-0163: Personal Eventing Protocol</a></li>
    <li><a href="../xep/receipts.html" title="XEP-0184: Message Delivery Receipts"><span class="none"></span>XEP-0184: Message Delivery Receipts</a></li>
    <li><a href="../xep/time.html" title="XEP-0202: Entity Time"><span class="none"></span>XEP-0202: Entity Time</a></li>
    <li><a href="../xep/delay.html" title="XEP-0203: Delayed Delivery"><span class="none"></span>XEP-0203: Delayed Delivery</a></li>
    <li><a href="../xep/carbons.html" title="XEP-0280: Message Carbons"><span class="none"></span>XEP-0280: Message Carbons</a></li>
    <li><a href="../xep/rtt.html" title="XEP-0301: In-Band Real Time Text"><span class="none"></span>XEP-0301: In-Band Real Time Text</a></li>
    <li><a href="../xep/message-correct.html" title="XEP-0308: Last Message Correction"><span class="none"></span>XEP-0308: Last Message Correction</a></li>
      <li class="nav-header">API Documentation</li>
    <li><a href="../apidocs/index.html" title="JavaDoc"><span class="none"></span>JavaDoc</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="../" title="" class="builtBy"><img class="builtBy"  alt="" src="../"    /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span9" >
<h1>XEP-0045: Multi-User Chat</h1><hr />
<p>For all MUC-related operations, you will need the <code>MultiUserChatManager</code>, which you can get like this:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">MultiUserChatManager multiUserChatManager = xmppClient.getManager(MultiUserChatManager.class);
</code></pre></div><section>
<h2><a name="Chat_Services"></a>Chat Services</h2>
<p>If you don't have an idea, which chat services your XMPP domain hosts, you can easily discover them:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">Collection&lt;ChatService&gt; chatServices = multiUserChatManager.discoverChatServices().getResult();
</code></pre></div>
<p>If you already know the address of your chat service, you can also create an instance of the <code>ChatService</code> directly:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">ChatService chatService = multiUserChatManager.createChatService(Jid.of(&quot;conference.yourxmppdomain&quot;));
</code></pre></div>
<p>A chat service allows you to do two things:</p>
<p>First, discovering public chat rooms hosted by this service:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">List&lt;ChatRoom&gt; publicRooms = chatService.discoverRooms().getResult();
</code></pre></div>
<p>or second - if you know an existing room or want to create a new one - creating a new chat room directly:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">ChatRoom chatRoom = chatService.createRoom(&quot;myroom&quot;);
</code></pre></div>
<p>whose room address would basically be <code>myroom@conference.yourxmppdomain</code>.</p>
<p>This can also be used, if you want to create instant chat rooms (e.g. with an UUID).</p>
<p>Note, that no room is created on the server! All you have now is a local <code>ChatRoom</code> instance, you can work with.</p></section><section>
<h2><a name="Chat_Rooms"></a>Chat Rooms</h2>
<p>Once you have a <code>ChatRoom</code> instance, you can now do multiple things with it:</p>
<ul>

<li>Discovering occupants in the room and room information.</li>
<li>Entering (aka joining) and exiting (aka leaving) the room.</li>
<li>Configuring a room.</li>
<li>Sending messages.</li>
<li>Listening to messages, subject changes, occupant events (&#x201c;leaves&#x201d; and &#x201c;joins&#x201d;), &#x2026;</li>
</ul><section>
<h3><a name="Discovering_Occupants_and_Room_Info"></a>Discovering Occupants and Room Info</h3>
<p>You can discover the occupants, which are currently in the room (nicknames only) with:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">List&lt;String&gt; occupants = chatRoom.discoverOccupants().getResult();
</code></pre></div>
<p>And you get additional room info (e.g. the current subject, the max history messages, the description and room features)
with:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">RoomInformation roomInfo = chatRoom.getRoomInformation().getResult();
</code></pre></div></section><section>
<h3><a name="Occupant_Use_Cases"></a>Occupant Use Cases</h3>
<p>These are the use cases, when you are <i>in</i> the room (or want to enter the room).</p><section>
<h4><a name="Entering_a_Room"></a>Entering a Room</h4>
<p>Before entering a room, you should add listeners to it, if you want to listen for occupants &#x201c;joins&#x201d; and &#x201c;leaves&#x201d;,
subject changes or messages being sent by the room, then enter the room with your desired nickname:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">chatRoom.addOccupantListener(e -&gt; {
    if (!e.getOccupant().isSelf()) {
        switch (e.getType()) {
            case ENTERED:
                System.out.println(e.getOccupant().getNick() + &quot; has entered the room.&quot;);
                break;
            case EXITED:
                System.out.println(e.getOccupant().getNick() + &quot; has exited the room.&quot;);
                break;
            case KICKED:
                System.out.println(e.getOccupant().getNick() + &quot; has been kicked out of the room.&quot;);
                break;
        }
    }
});

chatRoom.addInboundMessageListener(e -&gt; {
    Message message = e.getMessage();
    System.out.println(message.getFrom().getResource() + &quot;: &quot; + message.getBody());
});

chatRoom.addSubjectChangeListener(e -&gt; {
    System.out.println(e.getNickname() + &quot; changed the subject to '&quot; + e.getSubject() + &quot;'.&quot;);
});

chatRoom.enter(&quot;nickname&quot;);
</code></pre></div>
<p>You can also request history when entering, e.g.:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">chatRoom.enter(&quot;nickname&quot;, History.forMaxMessages(20));
</code></pre></div></section><section>
<h4><a name="Sending_Messages"></a>Sending Messages</h4>

<div class="source"><pre class="prettyprint"><code class="language-java">chatRoom.sendMessage(&quot;Hi all!&quot;);
</code></pre></div></section><section>
<h4><a name="Changing_Nickname"></a>Changing Nickname</h4>

<div class="source"><pre class="prettyprint"><code class="language-java">chatRoom.changeNickname(&quot;newNickname&quot;);
</code></pre></div></section><section>
<h4><a name="Inviting_Other_Users"></a>Inviting Other Users</h4>

<div class="source"><pre class="prettyprint"><code class="language-java">chatRoom.invite(Jid.of(&quot;romeo@example.net&quot;), &quot;Hey, please join the room&quot;);
</code></pre></div></section><section>
<h4><a name="Requesting_Voice"></a>Requesting Voice</h4>
<p>If you are a mere visitor to a moderated room, you can request voice:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">chatRoom.requestVoice();
</code></pre></div></section><section>
<h4><a name="Exiting_a_Room"></a>Exiting a Room</h4>
<p>In order to exit the room, simply call:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">chatRoom.exit();
</code></pre></div>
<p>Optionally you can also provide a presence status exit message:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">chatRoom.exit(&quot;Bye!&quot;);
</code></pre></div></section></section></section><section>
<h2><a name="Admin.2C_Owner_and_Moderator_Use_Cases"></a>Admin, Owner and Moderator Use Cases</h2>
<p>As admin, owner or moderator you have elevated privileges in the room, including banning users, kicking occupants,
change room subject, change room configuration, etc.</p><section>
<h3><a name="Modifying_the_Room_Subject"></a>Modifying the Room Subject</h3>

<div class="source"><pre class="prettyprint"><code class="language-java">chatRoom.changeSubject(&quot;New subject&quot;);
</code></pre></div></section><section>
<h3><a name="Changing_Roles_and_Affiliations"></a>Changing Roles and Affiliations</h3>
<p>If you have enough privileges in the room, you can ban users, kick occupants, grant moderator status, revoke voice,
etc&#x2026;</p>
<p>These use cases are all covered by two methods: <code>changeRole</code> and <code>changeAffiliation</code>. Here are some examples:</p><section>
<h4><a name="Granting_Moderator_Status"></a>Granting Moderator Status</h4>

<div class="source"><pre class="prettyprint"><code class="language-java">chatRoom.changeRole(Role.MODERATOR, &quot;nick&quot;, &quot;You are now a moderator!&quot;);
</code></pre></div></section><section>
<h4><a name="Banning_a_User"></a>Banning a User</h4>
<p>If you are allowed (you need to be admin or owner), you can ban a user based on his JID:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">chatRoom.changeAffiliation(Affiliation.OUTCAST, Jid.of(&quot;juliet@example.net&quot;), &quot;You are banned!&quot;);
</code></pre></div></section><section>
<h4><a name="Kicking_an_Occupant"></a>Kicking an Occupant</h4>
<p>If you are a moderator in the room, you can kick other occupants (based on their nickname):</p>

<div class="source"><pre class="prettyprint"><code class="language-java">chatRoom.changeRole(Role.NONE, &quot;nick&quot;, &quot;You are kicked!&quot;);
</code></pre></div></section></section><section>
<h3><a name="Destroying_a_Room"></a>Destroying a Room</h3>
<p>If you are owner, you can destroy the room.</p>

<div class="source"><pre class="prettyprint"><code class="language-java">chatRoom.destroy(&quot;Macbeth doth come.&quot;)
</code></pre></div></section></section><section>
<h2><a name="Managing_Room_Invitations"></a>Managing Room Invitations</h2><section>
<h3><a name="Listening_to_Room_Invitations"></a>Listening to Room Invitations</h3>
<p><code>MultiUserChatManager</code> listens for both kinds of invitations: <a class="externalLink" href="https://xmpp.org/extensions/xep-0045.html#invite-mediated">mediated</a> and <a class="externalLink" href="https://xmpp.org/extensions/xep-0249.html">direct</a>. You can listen
for them in the following way:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">multiUserChatManager.addInvitationListener(e -&gt; {
    // e.getInviter() has invited you to the MUC room e.getRoomAddress()
});
</code></pre></div></section><section>
<h3><a name="Accepting_an_Invitation"></a>Accepting an Invitation</h3>
<p>You get the MUC with <code>e.getRoomAddress()</code> of the event object. A room is in the form <code>room@chatservice</code>, so we
have to create the service and then the room at that service:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">ChatService chatService = multiUserChatManager.createChatService(new Jid(e.getRoomAddress().getDomain()));
ChatRoom chatRoom = chatService.createRoom(e.getRoomAddress().getLocal());
</code></pre></div>
<p>When you've created the room, you should add listeners to it and then enter it.</p></section><section>
<h3><a name="Declining_an_Invitation"></a>Declining an Invitation</h3>

<div class="source"><pre class="prettyprint"><code class="language-java">e.decline(&quot;I don't have time right now...&quot;);
</code></pre></div><section>
<h4><a name="Listening_for_Invitation_Declines"></a>Listening for Invitation Declines</h4>

<div class="source"><pre class="prettyprint"><code class="language-java">chatRoom.addInvitationDeclineListener(e -&gt; {
    // e.getInvitee() declined your invitation.
});
</code></pre></div></section></section></section>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2014&#x2013;2022
<a href="http://xmpp.rocks">XMPP.rocks</a>.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
