<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src\site\markdown/basics.md at 2022-09-26
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20220926" />
    <meta http-equiv="Content-Language" content="en" />
    <title>XMPP.rocks - Documentation &#x2013; Getting Started</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script type="text/javascript" src="./js/apache-maven-fluido-1.7.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>XMPP.rocks - Documentation</h2>
</div>
</div>
        <div class="pull-right"><div id="bannerRight"><img src="xmpp.png"  alt="XMPP.rocks - Documentation"/></div>
</div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2022-09-26<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 0.9.0</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://bitbucket.org/sco0ter/babbler/downloads" class="externalLink" title="Binaries">Binaries</a></li>
      <li class="pull-right"><a href="https://bitbucket.org/sco0ter/babbler/src" class="externalLink" title="Source Code">Source Code</a></li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Project Information</li>
    <li><a href="index.html" title="About"><span class="none"></span>About</a></li>
    <li><a href="xeps.html" title="Supported Specifications"><span class="none"></span>Supported Specifications</a></li>
    <li><a href="license.html" title="License"><span class="none"></span>License</a></li>
    <li><a href="changelog.html" title="Changelog"><span class="none"></span>Changelog</a></li>
    <li><a href="releasenotes.html" title="Release Notes"><span class="none"></span>Release Notes</a></li>
      <li class="nav-header">User Guide</li>
    <li class="active"><a href="#"><span class="none"></span>Getting Started</a></li>
    <li><a href="basic-concepts.html" title="Basic Concepts"><span class="none"></span>Basic Concepts</a></li>
    <li><a href="im.html" title="Contacts, Presence and Messaging"><span class="none"></span>Contacts, Presence and Messaging</a></li>
    <li><a href="extensions.html" title="Using Extensions"><span class="none"></span>Using Extensions</a></li>
    <li><a href="customextensions.html" title="Writing Custom Extensions"><span class="none"></span>Writing Custom Extensions</a></li>
    <li><a href="customiq.html" title="Custom IQs"><span class="none"></span>Custom IQs</a></li>
    <li><a href="customauthentication.html" title="Custom Authentication"><span class="none"></span>Custom Authentication</a></li>
    <li><a href="errors.html" title="Exceptions and XMPP Errors"><span class="none"></span>Exceptions and XMPP Errors</a></li>
    <li><a href="reconnection.html" title="Dis- and Reconnection"><span class="none"></span>Dis- and Reconnection</a></li>
    <li><a href="debugging.html" title="Debugging XMPP Traffic"><span class="none"></span>Debugging XMPP Traffic</a></li>
    <li><a href="buildinstructions.html" title="Build Instructions"><span class="none"></span>Build Instructions</a></li>
      <li class="nav-header">Extension Guide</li>
    <li><a href="xep/filetransfer.html" title="File Transfer"><span class="none"></span>File Transfer</a></li>
    <li><a href="xep/avatar.html" title="Avatars"><span class="none"></span>Avatars</a></li>
    <li><a href="xep/httpbind.html" title="HTTP Binding / BOSH"><span class="none"></span>HTTP Binding / BOSH</a></li>
    <li><a href="xep/externalcomponents.html" title="External Components"><span class="none"></span>External Components</a></li>
    <li><a href="xep/rpc.html" title="XEP-0009: Jabber-RPC"><span class="none"></span>XEP-0009: Jabber-RPC</a></li>
    <li><a href="xep/last.html" title="Last Activity and Idle Time"><span class="none"></span>Last Activity and Idle Time</a></li>
    <li><a href="xep/privacy.html" title="XEP-0016: Privacy Lists"><span class="none"></span>XEP-0016: Privacy Lists</a></li>
    <li><a href="xep/disco.html" title="XEP-0030: Service Discovery"><span class="none"></span>XEP-0030: Service Discovery</a></li>
    <li><a href="xep/muc.html" title="XEP-0045: Multi-User Chat"><span class="none"></span>XEP-0045: Multi-User Chat</a></li>
    <li><a href="xep/bookmarks.html" title="XEP-0048: Bookmarks"><span class="none"></span>XEP-0048: Bookmarks</a></li>
    <li><a href="xep/vcard.html" title="XEP-0054: vcard-temp"><span class="none"></span>XEP-0054: vcard-temp</a></li>
    <li><a href="xep/pubsub.html" title="XEP-0060: Publish-Subscribe"><span class="none"></span>XEP-0060: Publish-Subscribe</a></li>
    <li><a href="xep/xhtmlim.html" title="XEP-0071: XHTML-IM"><span class="none"></span>XEP-0071: XHTML-IM</a></li>
    <li><a href="xep/soap.html" title="XEP-0072: SOAP Over XMPP"><span class="none"></span>XEP-0072: SOAP Over XMPP</a></li>
    <li><a href="xep/amp.html" title="XEP-0079: Advanced Message Processing"><span class="none"></span>XEP-0079: Advanced Message Processing</a></li>
    <li><a href="xep/geoloc.html" title="XEP-0080: User Location"><span class="none"></span>XEP-0080: User Location</a></li>
    <li><a href="xep/version.html" title="XEP-0092: Software Version"><span class="none"></span>XEP-0092: Software Version</a></li>
    <li><a href="xep/rosterx.html" title="XEP-0144: Roster Item Exchange"><span class="none"></span>XEP-0144: Roster Item Exchange</a></li>
    <li><a href="xep/pep.html" title="XEP-0163: Personal Eventing Protocol"><span class="none"></span>XEP-0163: Personal Eventing Protocol</a></li>
    <li><a href="xep/receipts.html" title="XEP-0184: Message Delivery Receipts"><span class="none"></span>XEP-0184: Message Delivery Receipts</a></li>
    <li><a href="xep/time.html" title="XEP-0202: Entity Time"><span class="none"></span>XEP-0202: Entity Time</a></li>
    <li><a href="xep/delay.html" title="XEP-0203: Delayed Delivery"><span class="none"></span>XEP-0203: Delayed Delivery</a></li>
    <li><a href="xep/carbons.html" title="XEP-0280: Message Carbons"><span class="none"></span>XEP-0280: Message Carbons</a></li>
    <li><a href="xep/rtt.html" title="XEP-0301: In-Band Real Time Text"><span class="none"></span>XEP-0301: In-Band Real Time Text</a></li>
    <li><a href="xep/message-correct.html" title="XEP-0308: Last Message Correction"><span class="none"></span>XEP-0308: Last Message Correction</a></li>
      <li class="nav-header">API Documentation</li>
    <li><a href="apidocs/index.html" title="JavaDoc"><span class="none"></span>JavaDoc</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="" title="" class="builtBy"><img class="builtBy"  alt="" src=""    /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span9" >
<h1>Getting Started</h1><hr /><section>
<h2><a name="Establishing_an_XMPP_Client_Session"></a>Establishing an XMPP Client Session</h2>
<p>The first thing you want to do in order to connect to an XMPP server is creating a <code>XmppClient</code> object:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">XmppClient xmppClient = XmppClient.create(&quot;domain&quot;);
</code></pre></div>
<p>The <code>XmppClient</code> instance is the central object. Every other action you will do revolves around this instance (e.g.
sending and receiving messages).</p>
<p>A session to an XMPP server can be established in three ways (connection methods):</p>
<ol style="list-style-type: decimal">

<li>By a <a class="externalLink" href="https://xmpp.org/rfcs/rfc6120.html#tcp">normal TCP socket connection</a></li>
<li>By a <a class="externalLink" href="https://xmpp.org/extensions/xep-0124.html">BOSH connection (XEP-0124)</a></li>
<li>By a <a class="externalLink" href="https://tools.ietf.org/html/rfc7395">WebSocket connection (RFC 7395)</a></li>
</ol>
<p>By default, the <code>XmppClient</code> will try to establish a connection via TCP first during the connection process. If the
connection fails, it will try to discover alternative connection methods and try to connect with one of them (usually
BOSH). The hostname and port is determined by doing a DNS lookup.</p><section>
<h3><a name="Configuring_the_Connections"></a>Configuring the Connections</h3>
<p>You can also configure different connection methods manually (e.g. if you want to use another port or want to use a
proxy).</p>
<p>In order to create immutable and reusable configuration objects (which could be reused by multiple sessions) and to
avoid huge constructors, the Builder Pattern is used to create custom configurations:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">TcpConnectionConfiguration tcpConfiguration = TcpConnectionConfiguration.builder()
    .hostname(&quot;localhost&quot;)
    .port(5222)
    .build();
</code></pre></div>
<p>Here's another example how to configure a BOSH connection (which would connect to the
URL <code>http://domain:5280/http-bind/</code> over a HTTP proxy server):</p>

<div class="source"><pre class="prettyprint"><code class="language-java">BoshConnectionConfiguration boshConfiguration = BoshConnectionConfiguration.builder()
    .hostname(&quot;domain&quot;)
    .port(5280)
    .proxy(new Proxy(Proxy.Type.HTTP, new InetSocketAddress(&quot;hostname&quot;, 3128)))
    .path(&quot;/http-bind/&quot;)
    .build();
</code></pre></div>
<p>And this is how you would configure a WebSocket connection to <code>wss://host:7443/ws</code> (requires <code>xmpp-websocket</code>
dependency):</p>

<div class="source"><pre class="prettyprint"><code class="language-java">WebSocketConnectionConfiguration webSocketConfiguration = WebSocketConnectionConfiguration.builder()
    .hostname(&quot;host&quot;)
    .port(7443)
    .path(&quot;/ws/&quot;)
    .sslContext(sslContext)
    .channelEncryption(ChannelEncryption.DIRECT)
    .build();
</code></pre></div>
<p>Now let's pass them to the <code>XmppClient</code> to tell it that it should use them:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">XmppClient xmppClient = XmppClient.create(&quot;domain&quot;, tcpConfiguration, boshConfiguration);
</code></pre></div>
<p>During connecting, the client will try all configured connections in order, until a connection is established.</p>
<p>Here's an overview over the relation between the session and connections:</p>
<p><img src="XmppSession.png" alt="Architecture" /></p><section>
<h4><a name="Securing_the_Connection"></a>Securing the Connection</h4>
<p>You can set a custom <code>SSLContext</code> by configuring it like this:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">TcpConnectionConfiguration tcpConfiguration = TcpConnectionConfiguration.builder()
    .channelEncryption(ChannelEncryption.OPTIONAL)
    .sslContext(sslContext)
    .hostnameVerifier(hostnameVerifier)
    .build();
</code></pre></div>
<p>Note that the use of a custom <code>HostnameVerifier</code> is possible but not recommended in most cases, since the built-in logic
to verify the host name does a good job.</p></section></section></section><section>
<h2><a name="Preparing_the_Session"></a>Preparing the Session</h2>
<p>Before connecting to a server, you should configure your XMPP session.</p>
<p>You might want to do one of the following:</p>
<ul>

<li>Adding event listeners in order to listen for inbound messages, roster and presence changes or to modify outbound
messages.</li>
<li>Configuring extensions, e.g.
<ul>

<li>Enable or disable certain extensions</li>
<li>Setting an identity for the connection (Service Discovery)</li>
<li>etc.</li>
</ul>
</li>
</ul>
<p>Here are some examples:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">// Listen for presence changes
xmppClient.addInboundPresenceListener(e -&gt; {
    Presence presence = e.getPresence();
    // Handle inbound presence.
});
// Listen for messages
xmppClient.addInboundMessageListener(e -&gt; {
    Message message = e.getMessage();
    // Handle inbound message.
});
// Listen for roster pushes
xmppClient.getManager(RosterManager.class).addRosterListener(e -&gt; {
    // Roster has changed
});
</code></pre></div></section><section>
<h2><a name="Connecting_to_a_Server"></a>Connecting to a Server</h2>
<p>If you have prepared your session, you are now ready to connect to the server:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">try {
   xmppClient.connect();
} catch (XmppException e) {
   // ...
}
</code></pre></div>
<p>The session will try to connect to the XMPP server by using the configured connections in order.</p>
<p>Connecting involves opening the initial XMPP stream header and negotiate any features offered by the server (most likely
only TLS).</p></section><section>
<h2><a name="Authenticating_and_Binding_a_Resource"></a>Authenticating and Binding a Resource</h2>
<p>After connecting, you have to authenticate and bind a resource, in order to become a &#x201c;connected resource&#x201d;. Both steps
are understood as &#x201c;login&#x201d;:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">try {
   xmppClient.login(&quot;username&quot;, &quot;password&quot;, &quot;resource&quot;);
} catch (AuthenticationException e) {
   // Login failed, because the server returned a SASL failure, most likely due to wrong credentials.
} catch (XmppException e) {
   // Other causes, e.g. no response, failure during resource binding, etc.
}
</code></pre></div>
<p>Initial presence is sent automatically, so that you are now an &quot;available resource&quot; (you will appear online to your
contacts) and can now start sending messages.</p></section><section>
<h2><a name="Sending_a_Message"></a>Sending a Message</h2>
<p>Sending a simple chat message works like this:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">xmppClient.send(new Message(Jid.of(&quot;juliet@example.net&quot;), Message.Type.CHAT));
</code></pre></div></section><section>
<h2><a name="Changing_Availability"></a>Changing Availability</h2>
<p>If you want to change your presence availability, just send a new presence with a &#x201c;show&#x201d; value.</p>

<div class="source"><pre class="prettyprint"><code class="language-java">xmppClient.send(new Presence(Presence.Show.AWAY));
</code></pre></div></section><section>
<h2><a name="Closing_the_Session"></a>Closing the Session</h2>
<p>Closing a session is simply done with:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">xmppClient.close();
</code></pre></div>
<p>Note, that <code>XmppClient</code> implements <code>java.lang.AutoCloseable</code>, which means you can also use the try-with-resources
statement, which automatically closes the session:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">try (XmppClient xmppClient = XmppClient.create(&quot;domain&quot;)) {
    xmppClient.connect();
} catch (XmppException e) {
    // handle exception
}
</code></pre></div></section>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2014&#x2013;2022
<a href="http://xmpp.rocks">XMPP.rocks</a>.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
