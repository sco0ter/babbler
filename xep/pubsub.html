<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src\site\markdown/xep\pubsub.md at 2022-09-26
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20220926" />
    <meta http-equiv="Content-Language" content="en" />
    <title>XMPP.rocks - Documentation &#x2013; XEP-0060: Publish-Subscribe</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script type="text/javascript" src="../js/apache-maven-fluido-1.7.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>XMPP.rocks - Documentation</h2>
</div>
</div>
        <div class="pull-right"><div id="bannerRight"><img src="../xmpp.png"  alt="XMPP.rocks - Documentation"/></div>
</div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2022-09-26<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 0.9.0</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://bitbucket.org/sco0ter/babbler/downloads" class="externalLink" title="Binaries">Binaries</a></li>
      <li class="pull-right"><a href="https://bitbucket.org/sco0ter/babbler/src" class="externalLink" title="Source Code">Source Code</a></li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Project Information</li>
    <li><a href="../index.html" title="About"><span class="none"></span>About</a></li>
    <li><a href="../xeps.html" title="Supported Specifications"><span class="none"></span>Supported Specifications</a></li>
    <li><a href="../license.html" title="License"><span class="none"></span>License</a></li>
    <li><a href="../changelog.html" title="Changelog"><span class="none"></span>Changelog</a></li>
    <li><a href="../releasenotes.html" title="Release Notes"><span class="none"></span>Release Notes</a></li>
      <li class="nav-header">User Guide</li>
    <li><a href="../basics.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../basic-concepts.html" title="Basic Concepts"><span class="none"></span>Basic Concepts</a></li>
    <li><a href="../im.html" title="Contacts, Presence and Messaging"><span class="none"></span>Contacts, Presence and Messaging</a></li>
    <li><a href="../extensions.html" title="Using Extensions"><span class="none"></span>Using Extensions</a></li>
    <li><a href="../customextensions.html" title="Writing Custom Extensions"><span class="none"></span>Writing Custom Extensions</a></li>
    <li><a href="../customiq.html" title="Custom IQs"><span class="none"></span>Custom IQs</a></li>
    <li><a href="../customauthentication.html" title="Custom Authentication"><span class="none"></span>Custom Authentication</a></li>
    <li><a href="../errors.html" title="Exceptions and XMPP Errors"><span class="none"></span>Exceptions and XMPP Errors</a></li>
    <li><a href="../reconnection.html" title="Dis- and Reconnection"><span class="none"></span>Dis- and Reconnection</a></li>
    <li><a href="../debugging.html" title="Debugging XMPP Traffic"><span class="none"></span>Debugging XMPP Traffic</a></li>
    <li><a href="../buildinstructions.html" title="Build Instructions"><span class="none"></span>Build Instructions</a></li>
      <li class="nav-header">Extension Guide</li>
    <li><a href="../xep/filetransfer.html" title="File Transfer"><span class="none"></span>File Transfer</a></li>
    <li><a href="../xep/avatar.html" title="Avatars"><span class="none"></span>Avatars</a></li>
    <li><a href="../xep/httpbind.html" title="HTTP Binding / BOSH"><span class="none"></span>HTTP Binding / BOSH</a></li>
    <li><a href="../xep/externalcomponents.html" title="External Components"><span class="none"></span>External Components</a></li>
    <li><a href="../xep/rpc.html" title="XEP-0009: Jabber-RPC"><span class="none"></span>XEP-0009: Jabber-RPC</a></li>
    <li><a href="../xep/last.html" title="Last Activity and Idle Time"><span class="none"></span>Last Activity and Idle Time</a></li>
    <li><a href="../xep/privacy.html" title="XEP-0016: Privacy Lists"><span class="none"></span>XEP-0016: Privacy Lists</a></li>
    <li><a href="../xep/disco.html" title="XEP-0030: Service Discovery"><span class="none"></span>XEP-0030: Service Discovery</a></li>
    <li><a href="../xep/muc.html" title="XEP-0045: Multi-User Chat"><span class="none"></span>XEP-0045: Multi-User Chat</a></li>
    <li><a href="../xep/bookmarks.html" title="XEP-0048: Bookmarks"><span class="none"></span>XEP-0048: Bookmarks</a></li>
    <li><a href="../xep/vcard.html" title="XEP-0054: vcard-temp"><span class="none"></span>XEP-0054: vcard-temp</a></li>
    <li class="active"><a href="#"><span class="none"></span>XEP-0060: Publish-Subscribe</a></li>
    <li><a href="../xep/xhtmlim.html" title="XEP-0071: XHTML-IM"><span class="none"></span>XEP-0071: XHTML-IM</a></li>
    <li><a href="../xep/soap.html" title="XEP-0072: SOAP Over XMPP"><span class="none"></span>XEP-0072: SOAP Over XMPP</a></li>
    <li><a href="../xep/amp.html" title="XEP-0079: Advanced Message Processing"><span class="none"></span>XEP-0079: Advanced Message Processing</a></li>
    <li><a href="../xep/geoloc.html" title="XEP-0080: User Location"><span class="none"></span>XEP-0080: User Location</a></li>
    <li><a href="../xep/version.html" title="XEP-0092: Software Version"><span class="none"></span>XEP-0092: Software Version</a></li>
    <li><a href="../xep/rosterx.html" title="XEP-0144: Roster Item Exchange"><span class="none"></span>XEP-0144: Roster Item Exchange</a></li>
    <li><a href="../xep/pep.html" title="XEP-0163: Personal Eventing Protocol"><span class="none"></span>XEP-0163: Personal Eventing Protocol</a></li>
    <li><a href="../xep/receipts.html" title="XEP-0184: Message Delivery Receipts"><span class="none"></span>XEP-0184: Message Delivery Receipts</a></li>
    <li><a href="../xep/time.html" title="XEP-0202: Entity Time"><span class="none"></span>XEP-0202: Entity Time</a></li>
    <li><a href="../xep/delay.html" title="XEP-0203: Delayed Delivery"><span class="none"></span>XEP-0203: Delayed Delivery</a></li>
    <li><a href="../xep/carbons.html" title="XEP-0280: Message Carbons"><span class="none"></span>XEP-0280: Message Carbons</a></li>
    <li><a href="../xep/rtt.html" title="XEP-0301: In-Band Real Time Text"><span class="none"></span>XEP-0301: In-Band Real Time Text</a></li>
    <li><a href="../xep/message-correct.html" title="XEP-0308: Last Message Correction"><span class="none"></span>XEP-0308: Last Message Correction</a></li>
      <li class="nav-header">API Documentation</li>
    <li><a href="../apidocs/index.html" title="JavaDoc"><span class="none"></span>JavaDoc</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="../" title="" class="builtBy"><img class="builtBy"  alt="" src="../"    /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span9" >
<h1>XEP-0060: Publish-Subscribe</h1><hr />
<p><a class="externalLink" href="https://xmpp.org/extensions/xep-0060.html" title="XEP-0060: Publish-Subscribe">XEP-0060: Publish-Subscribe</a> allows XMPP entities to create nodes (topics) at a pubsub service and publish
information at those nodes; an event notification (with or without payload) is then broadcasted to all entities that
have subscribed to the node. Pubsub therefore adheres to the classic Observer design pattern and can serve as the
foundation for a wide variety of applications, including news feeds, content syndication, rich presence, geolocation,
workflow systems, network management systems, and any other application that requires event notifications.</p>
<p>For all PubSub related operations you need the <code>PubSubManager</code>.</p>

<div class="source"><pre class="prettyprint"><code class="language-java">PubSubManager pubSubManager = xmppClient.getManager(PubSubManager.class);
</code></pre></div><section>
<h2><a name="Discovering_PubSub_Services"></a>Discovering PubSub Services</h2>
<p>If you don't know the address of your server's pubsub service, you can discover pubsub services like that:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">Collection&lt;PubSubService&gt; pubSubServices = pubSubManager.discoverPubSubServices().getResult();
</code></pre></div>
<p>The resulting list will contain the available PubSub services on your server. Most often it's probably only one: &quot;
pubsub.yourxmppdomain&quot;.</p></section><section>
<h2><a name="Using_a_PubSub_Service"></a>Using a PubSub Service</h2>
<p>If you know the address of a PubSub service, you can also create a pubsub service like this:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">PubSubService pubSubService = pubSubManager.createPubSubService(Jid.of(&quot;pubsub.yourxmppdomain&quot;));
</code></pre></div>
<p>The <code>PubSubService</code> instance allows you to perform all use cases described in <a class="externalLink" href="https://xmpp.org/extensions/xep-0060.html" title="XEP-0060: Publish-Subscribe">XEP-0060</a>. Here are the most
important of them:</p><section>
<h3><a name="Discovering_PubSub_Features"></a>Discovering PubSub Features</h3>
<p>Because <a class="externalLink" href="https://xmpp.org/extensions/xep-0060.html" title="XEP-0060: Publish-Subscribe">XEP-0060</a> is quite complex and many features are optional, a PubSub service might not support all
PubSub features. You can get the supported features of your service like that:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">Collection&lt;PubSubFeature&gt; pubSubFeatures = pubSubService.discoverFeatures().getResult();
</code></pre></div>
<p>Each feature is represented as an enum value of <code>PubSubFeature</code>, e.g. <code>PubSubFeature.AUTO_SUBSCRIBE</code>. If you want to
know, if the service supports a feature, you can simply ask for:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">pubSubFeatures.contains(PubSubFeature.INSTANT_NODES);
</code></pre></div></section></section><section>
<h2><a name="Working_with_PubSub_Nodes"></a>Working with PubSub Nodes</h2>
<p>Whenever you want to work with a node (e.g. publish items, subscribe, unsubscribe, etc&#x2026;), you first need to get an
instance of <code>PubSubNode</code>.</p>

<div class="source"><pre class="prettyprint"><code class="language-java">PubSubNode pubSubNode = pubSubService.node(&quot;princely_musings&quot;);
</code></pre></div>
<p>This will just create a <code>PubSubNode</code> instance locally which acts as an interface to the PubSub service and provides
methods to work with the node.</p><section>
<h3><a name="Creating_the_Node"></a>Creating the Node</h3>
<p>This will create the node on the server:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">pubSubNode.create();
</code></pre></div></section><section>
<h3><a name="Publishing_Content_to_a_Node"></a>Publishing Content to a Node</h3>
<p>The following publishes a <a class="externalLink" href="https://xmpp.org/extensions/xep-0118.html" title="XEP-0118: User Tune">Tune</a> to the node.</p>

<div class="source"><pre class="prettyprint"><code class="language-java">pubSubNode.publish(new Tune(&quot;Artist&quot;, &quot;Title&quot;));
</code></pre></div>
<p><i>(Note, that this works, because <code>Tune</code> is known to the JAXB Context. Unknown objects won't work)</i></p></section><section>
<h3><a name="Subscribing_to_a_Node"></a>Subscribing to a Node</h3>
<p>If you are interested in receiving event notifications, whenever content of a node has been updated, you have to
subscribe to the node.</p>

<div class="source"><pre class="prettyprint"><code class="language-java">pubSubNode.subscribe();
</code></pre></div></section><section>
<h3><a name="Unsubscribing_from_a_Node"></a>Unsubscribing from a Node</h3>
<p>If you are no longer interested in receiving event notifications, you can unsubscribe from it again.</p>

<div class="source"><pre class="prettyprint"><code class="language-java">pubSubNode.unsubscribe();
</code></pre></div></section><section>
<h3><a name="Listening_for_PubSub_Events"></a>Listening for PubSub Events</h3>
<p>For now, you have to just deal directly with the messages. This may change in the future.</p>

<div class="source"><pre class="prettyprint"><code class="language-java">xmppClient.addInboundMessageListener(e -&gt; {
    Message message = e.getMessage();
    Event event = message.getExtension(Event.class);
    if (event != null) {
        for (Item item : event.getItems()) {
            // ...
        }
    }
});
</code></pre></div></section></section><section>
<h2><a name="Dealing_with_PubSub_Errors"></a>Dealing with PubSub Errors</h2>
<p><a class="externalLink" href="https://xmpp.org/extensions/xep-0060.html" title="XEP-0060: Publish-Subscribe">PubSub</a> defines multiple errors for various use cases. Those errors are an extension of stanza errors.</p>
<p>The following shows, how to deal with pubsub specific errors.</p>

<div class="source"><pre class="prettyprint"><code class="language-java">try {
    PubSubService pubSubService = pubSubManager.createPubSubService(Jid.of(&quot;pubsub.yourdomain&quot;));
    PubSubNode pubSubNode = pubSubService.node(&quot;princely_musings&quot;);
    pubSubNode.subscribe().getResult();
}  catch (StanzaException e) {
    Object extension = e.getStanza().getError().getExtension();
    if (extension instanceof PresenceSubscriptionRequired) {
        // PubSub error &lt;presence-subscription-required xmlns='http://jabber.org/protocol/pubsub#errors'/&gt; occurred.
    }
}
</code></pre></div>
<p>PubSub errors can be found in the <code>rocks.xmpp.extensions.pubsub.model.errors</code> package.</p></section>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2014&#x2013;2022
<a href="http://xmpp.rocks">XMPP.rocks</a>.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
